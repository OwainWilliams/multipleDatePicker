(function(n){"use strict";var t=function(){return{restrict:"AE",scope:{ngModel:"=?",highlightDays:"=?",dayClick:"=?",dayHover:"=?",rightClick:"=?",month:"=?",monthChanged:"=?",monthClick:"=?",weekDaysOff:"=?",allDaysOff:"=?",daysAllowed:"=?",sundayFirstDay:"=?",disableNavigation:"=?",disallowBackPastMonths:"=?",disallowGoFuturMonths:"=?",showDaysOfSurroundingMonths:"=?",cssDaysOfSurroundingMonths:"=?",fireEventsForDaysOfSurroundingMonths:"=?",disableDaysBefore:"=?",disableDaysAfter:"=?",changeYearPast:"=?",changeYearFuture:"=?"},template:'<div class="multiple-date-picker"><div class="picker-top-row"><div class="text-center picker-navigate picker-navigate-left-arrow" ng-class="{\'disabled\':disableBackButton}" ng-click="changeMonth($event, disableBackButton, -1)">&lt;<\/div><div class="text-center picker-month">{{monthToDisplay}} <span ng-if="yearsForSelect.length < 2">{{yearToDisplay}}<\/span><select ng-if="yearsForSelect.length > 1" ng-model="year" ng-change="changeYear(year)" ng-options="y for y in yearsForSelect"><\/select><\/div><div class="text-center picker-navigate picker-navigate-right-arrow" ng-class="{\'disabled\':disableNextButton}" ng-click="changeMonth($event, disableNextButton, 1)">&gt;<\/div><\/div><div class="picker-days-week-row"><div class="text-center" ng-repeat="day in daysOfWeek">{{day}}<\/div><\/div><div class="picker-days-row"><div class="text-center picker-day {{getDayClasses(day)}}" title="{{day.title}}" ng-repeat="day in days" ng-click="toggleDay($event, day)" ng-mouseover="hoverDay($event, day)" ng-mouseleave="dayHover($event, day)" mdp-right-click="rightClicked($event,day)">{{day ? day.mdp.otherMonth && !showDaysOfSurroundingMonths ? \'&nbsp;\' : day.date.format(\'D\') : \'\'}}<\/div><\/div><\/div>',link:function(t){t.ngModel=t.ngModel||[];var f=function(){var n=moment(),i=moment(t.month).subtract(1,"month"),r=moment(t.month).add(1,"month");t.disableBackButton=t.disableNavigation||t.disallowBackPastMonths&&n.isAfter(i,"month");t.disableNextButton=t.disableNavigation||t.disallowGoFuturMonths&&n.isBefore(r,"month")},r=function(){for(var i=moment().localeData()._weekdaysMin,n=[],r=1;r<7;r++)n.push(i[r]);return t.sundayFirstDay?n.splice(0,0,i[0]):n.push(i[0]),n},u=function(){var n=t.month.format("MMMM");return n.charAt(0).toUpperCase()+n.slice(1)},e=function(){var i=moment(),f=Math.max(0,parseInt(t.changeYearPast,10)||0),e=Math.max(0,parseInt(t.changeYearFuture,10)||0),o=moment(t.month).subtract(f,"year"),r=moment(t.month).add(e,"year"),u=[],n;for(r.add(1,"year"),n=moment(o);r.isAfter(n,"YEAR");n.add(1,"year"))(!t.disallowBackPastMonths||n.isAfter(i,"year")||n.isSame(i,"year"))&&(!t.disallowGoFuturMonths||n.isBefore(i,"year")||n.isSame(i,"year"))&&u.push(n.format("YYYY"));return u},i=[];i.push(t.$watch("ngModel",function(){t.generate()},!0));i.push(t.$watch("month",function(){t.generate()},!0));i.push(t.$watch("highlightDays",function(){t.generate()},!0));i.push(t.$watch("weekDaysOff",function(){t.generate()},!0));i.push(t.$watch("allDaysOff",function(){t.generate()},!0));i.push(t.$watch("daysAllowed",function(){t.generate()},!0));i.push(t.$watch("disableDaysBefore",function(){t.generate()},!0));i.push(t.$watch("disableDaysAfter",function(){t.generate()},!0));i.push(t.$watch(function(){return moment.locale()},function(){t.daysOfWeek=r();t.monthToDisplay=u()},!0));t.$on("destroy",function(){for(var n=0;n<i.length;n++)i[n]()});t.month=t.month||moment().startOf("day");t.days=[];t.weekDaysOff=t.weekDaysOff||[];t.daysOff=t.daysOff||[];t.disableBackButton=!1;t.disableNextButton=!1;t.daysOfWeek=r();t.cssDaysOfSurroundingMonths=t.cssDaysOfSurroundingMonths||"picker-empty";t.yearsForSelect=[];t.toggleDay=function(n,i){var f,u,r;if((n.preventDefault(),!i.mdp.otherMonth||t.fireEventsForDaysOfSurroundingMonths)&&(f=!1,n.preventDefault=function(){f=!0},typeof t.dayClick=="function"&&t.dayClick(n,i),i.selectable&&!f))if(i.mdp.selected=!i.mdp.selected,i.mdp.selected)t.ngModel.push(i.date);else{for(u=-1,r=0;r<t.ngModel.length;++r)if(moment.isMoment(t.ngModel[r])){if(t.ngModel[r].isSame(i.date,"day")){u=r;break}}else if(t.ngModel[r].date.isSame(i.date,"day")){u=r;break}u!==-1&&t.ngModel.splice(u,1)}};t.hoverDay=function(n,i){n.preventDefault();var r=!1;n.preventDefault=function(){r=!0};typeof t.dayHover=="function"&&t.dayHover(n,i);r||(i.mdp.hover=n.type==="mouseover")};t.rightClicked=function(n,i){typeof t.rightClick=="function"&&(n.preventDefault(),t.rightClick(n,i))};t.getDayClasses=function(n){var i="";return n.css&&(!n.mdp.otherMonth||t.showDaysOfSurroundingMonths)&&(i+=" "+n.css),t.cssDaysOfSurroundingMonths&&n.mdp.otherMonth&&(i+=" "+t.cssDaysOfSurroundingMonths),n.mdp.selected&&(i+=" picker-selected"),n.selectable||(i+=" picker-off"),n.mdp.today&&(i+=" today"),n.mdp.past&&(i+=" past"),n.mdp.future&&(i+=" future"),n.mdp.otherMonth&&(i+=" picker-other-month"),i};t.changeMonth=function(n,i,r){var u,f,e;i||(n.preventDefault(),u=!1,n.preventDefault=function(){u=!0},f=moment(t.month).add(r,"month"),typeof t.monthClick=="function"&&t.monthClick(n,f),u||(e=moment(t.month),t.month=f,typeof t.monthChanged=="function"&&t.monthChanged(t.month,e)))};t.changeYear=function(n){t.month=t.month.year(parseInt(n,10))};t.isDayOff=function(i){return t.allDaysOff||!!t.disableDaysBefore&&moment(i.date).isBefore(t.disableDaysBefore,"day")||!!t.disableDaysAfter&&moment(i.date).isAfter(t.disableDaysAfter,"day")||n.isArray(t.weekDaysOff)&&t.weekDaysOff.some(function(n){return i.date.day()===n})||n.isArray(t.daysOff)&&t.daysOff.some(function(n){return i.date.isSame(n,"day")})||n.isArray(t.daysAllowed)&&!t.daysAllowed.some(function(n){return i.date.isSame(n,"day")})||n.isArray(t.highlightDays)&&t.highlightDays.some(function(n){return i.date.isSame(n.date,"day")&&!n.selectable})};t.isSelected=function(n){return t.ngModel.some(function(t){return n.date.isSame(t,"day")})};t.generate=function(){var i,s;t.year=t.month.year().toString();t.yearsForSelect=e();t.monthToDisplay=u();t.yearToDisplay=t.month.format("YYYY");i=moment(t.month).date(0).day(t.sundayFirstDay?0:1).subtract(1,"day");moment(t.month).date(0).diff(i,"day")>6&&(i=i.add(1,"week"));var l=moment(t.month).date(1),h=[],r=moment(),o=moment(l).endOf("month"),a=function(){var u={date:moment(i.add(1,"day")),mdp:{selected:!1}},f;return n.isArray(t.highlightDays)&&(f=t.highlightDays.filter(function(n){return u.date.isSame(n.date,"day")}),u.css=f.length>0?f[0].css:"",u.title=f.length>0?f[0].title:""),u.selectable=!t.isDayOff(u),u.mdp.selected=t.isSelected(u),u.mdp.today=u.date.isSame(r,"day"),u.mdp.past=u.date.isBefore(r,"day"),u.mdp.future=u.date.isAfter(r,"day"),u.date.isSame(t.month,"month")||(u.mdp.otherMonth=!0),u},c=o.diff(i,"days"),v=t.sundayFirstDay?6:0;for(o.day()!==v&&(c+=(t.sundayFirstDay?6:7)-o.day()),s=0;s<c;s++)h.push(a());t.days=h;f()};t.generate()}}};n.module("multipleDatePicker",[]).directive("multipleDatePicker",t).directive("mdpRightClick",["$parse",function(n){return function(t,i,r){var u=n(r.mdpRightClick);i.bind("contextmenu",function(n){t.$apply(function(){u(t,{$event:n})})})}}])})(window.angular);